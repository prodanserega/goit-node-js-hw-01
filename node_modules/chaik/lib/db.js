const assert = require('assert')
    , knex = require('knex')

let instance = undefined
exports.initDbConnection = function (connectionConfig) {
    instance = knex(connectionConfig)
}

exports.yes = function* (target, tableName, condition) {
    assert.notEqual(target, undefined)
    assert.ok(tableName != undefined && tableName != "")
    assert.notEqual(condition, undefined)
    assert.ok(Object.keys(condition).length > 0)

    assert.notEqual(instance, undefined)

    let rows = yield instance(tableName).where(condition).select()
    assert.deepEqual(target, rows)
}

exports.no = function* (tableName, condition) {
    assert.ok(tableName != undefined && tableName != "")
    assert.notEqual(condition, undefined)
    assert.ok(Object.keys(condition).length > 0)

    assert.notEqual(instance, undefined)

    let rows = yield instance(tableName).where(condition).select()
    assert.ok(rows == undefined || rows == null || rows.length == 0)
}