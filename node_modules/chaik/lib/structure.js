const assert = require('assert')
let verify = function (target, structure) {
    assert.notEqual(target, undefined)
    assert.notEqual(structure, undefined)

    Object.keys(structure).forEach(index => {
        if (isNaN(index)) { //structure is an obj 
            let targetIndex = index[0] == "*" ?
                index.substr(1) : index
            let value = target[targetIndex]
            if (index == targetIndex || value) {
                assert.notEqual(value, undefined)
                let format = structure[index]
                return verify(target[targetIndex], format)
            }
        } else {//structure is an array , index is a number
            let format = structure[index]
            let type = typeof (format)
            if (type == "string") {
                let targetIndex = format[0] == "*" ?
                    format.substr(1) : format
                let value = target[targetIndex]
                if (format == targetIndex || value) {
                    assert.notEqual(value, undefined)
                }
            } else if (format instanceof Array) {
                return verify(target[index], format)
            } else {
                return verify(target, format)
            }
        }
    })
}

exports.verifyStructure = verify