const assert = require('assert')

let see = require('../')

exports.run = function () {
    let willPassItems = [
        { target: {}, structure: [] },
        { target: { a: 1 }, structure: ["a"] },
        { target: { a: 1, b: 2 }, structure: ["a"] },
        { target: { a: 1, b: { c: 2 } }, structure: ["a", { b: ["c"] }] },
        { target: { a: 1, b: { c: { d: 2 } } }, structure: ["a", { b: { c: ["d"] } }] },
        { target: [1, 2], structure: [] },

        { target: [{ a: 1 }], structure: [["a"]] },

        { target: {}, structure: ["*a"] },
        { target: { a: 1 }, structure: ["*a"] },
        { target: { a: 1 }, structure: ["a", { "*b": ["c"] }] },
        { target: { a: 1 }, structure: ["*a", { "*b": ["c"] }] },
        { target: { a: 1, b: { c: 2 } }, structure: ["*a", { "*b": ["c"] }] },

        { target: { a: { b: 2 } }, structure: { "a": ["b"] } },
        { target: { a: { b: [1, 2, 3] } }, structure: { "a": { "b": [] } } },
        { target: { a: [1, 2, 3] }, structure: { "a": [] } },
    ]
    willPassItems.forEach(item => {
        assert.doesNotThrow(function () {
            see.structure(item.target, item.structure)
        }, 'no exception')
    })

    let willThrowItems = [
        { target: undefined, structure: ["a"] },
        { target: {}, structure: undefined },
        { target: undefined, structure: undefined },
        { target: {}, structure: ["a"] },
        { target: { a: 1 }, structure: ["a", "b"] },
        { target: { a: 1, b: { c: 2 } }, structure: ["a", ["d", ["c"]]] },

        { target: { a: { b: 2 } }, structure: { "b": ["b"] } },
        { target: { a: { b: 2 } }, structure: { a: ["c"] } },
    ]
    willThrowItems.forEach(item => {
        assert.throws(function () {
            see.structure(item.target, item.structure)
        }, verifyExceptionType)
    })

    console.log('structure test passed')
}
function verifyExceptionType(err) {
    if (err instanceof assert.AssertionError) {
        return true;
    }
}
